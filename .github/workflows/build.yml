name: Build SuperFlix

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      # 1. CHECKOUT
      - uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      # 2. SETUP JAVA
      - name: Set up JDK 17
        uses: actions/setup-java@v4 
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: 'gradle'

      - name: Grant execute permission for gradlew
        run: chmod +x gradlew

      # 3. BUILD DIRETO - SIMPLES
      - name: Build with Gradle
        run: |
          echo "=== INICIANDO BUILD ==="
          
          # Build limpo e simples
          ./gradlew :SuperFlix:clean :SuperFlix:assembleDebug
          
          echo "=== BUILD COMPLETO ==="

      # 4. VERIFICAR SE FUNCIONOU
      - name: Verificar BuildConfig
        run: |
          echo "=== VERIFICANDO BUILDCONFIG ==="
          
          # Procurar BuildConfig do seu m√≥dulo
          find . -name "BuildConfig.java" -path "*/superflix/*" 2>/dev/null | while read file; do
            echo "üìÑ Arquivo: $file"
            
            # Mostrar apenas a linha TMDB
            if grep -q "TMDB_API_KEY" "$file"; then
              echo "‚úÖ TMDB_API_KEY encontrada"
              LINE=$(grep "TMDB_API_KEY" "$file")
              echo "Conte√∫do: $LINE"
              
              # Verificar se √© v√°lida
              if echo "$LINE" | grep -q '"b64d2f3a'; then
                echo "üéâ SUCESSO! Chave REAL encontrada!"
              elif echo "$LINE" | grep -q '"***"'; then
                echo "‚ùå FALHA! Chave est√° '***' (mascarada)"
              elif echo "$LINE" | grep -q '""'; then
                echo "‚ùå FALHA! Chave est√° VAZIA"
              else
                echo "‚ö†Ô∏è  Chave existe mas n√£o reconhecida"
              fi
            else
              echo "‚ùå TMDB_API_KEY N√ÉO encontrada"
            fi
            echo "---"
          done
